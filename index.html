<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <title>Danh sách sản phẩm</title>

  <!-- Import CSS đúng chuẩn GitHub Pages -->
  <link rel="stylesheet" href="./assets/css/styles.css?v=1">
</head>
<body>
  <h1>Danh sách sản phẩm</h1>

  <div class="top-controls">
    <button class="btn toggle" id="showFavsBtn" aria-pressed="false" title="Chỉ hiện mục yêu thích">Yêu thích</button>
  </div>

  <div class="list" id="product-list" aria-live="polite"></div>

  <div class="bottom-controls" id="bottomControls">
    <div class="control">
      <label class="muted">Phí ship
        <input type="text" id="ship_fee" data-raw="0" value="0" inputmode="numeric" pattern="[0-9]*" />
      </label>
    </div>
    <div class="control">
      <label class="muted">Giảm giá
        <input type="text" id="discount" data-raw="0" value="0" inputmode="numeric" pattern="[0-9]*" />
      </label>
    </div>

    <div style="margin-left:auto" class="actions">
      <button class="btn" id="resetBtn" title="Reset số lượng">Reset</button>
      <button class="btn" id="collapseBtn">Hoá đơn</button>
    </div>
  </div>

  <div class="summary" aria-live="polite">
    <div class="muted">Món đã chọn: <span id="selectedCount">0</span> · Yêu thích: <span id="favCount">0</span></div>
    <div class="total">Tổng: <span id="grandTotal">0</span> ₫</div>
  </div>

  <div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true">
    <div class="modal" role="document" id="modal">
      <h2>Hoá đơn</h2>
      <div id="compactList" class="compact" aria-live="polite"></div>
      
      <div class="footer">
        <div class="meta-lines">
          <div class="meta-line">Phí ship: <span id="modal_ship">0đ</span></div>
          <div class="meta-line">Giảm giá: <span id="modal_discount">0đ</span></div>
        </div>
        <div class="total-line" style="font-weight:800">Tổng: <span id="modal_total">0đ</span></div>
      </div>

      <div class="payment-row" id="paymentRow">
        <div role="radiogroup" aria-label="Phương thức thanh toán" class="small-muted">
          <label><input type="radio" name="payment_method" value="cash" checked /> Tiền mặt</label>
          <label style="margin-left:10px"><input type="radio" name="payment_method" value="qr"/> QR</label>
        </div>

        <div id="cashContainer" class="cash-box" aria-hidden="false" style="margin-left:8px">
          <label class="small-muted">Tiền khách đưa:
            <input id="cash_given" type="text" data-raw="0" value="0" inputmode="numeric" pattern="[0-9]*" style="padding:6px;border-radius:6px;border:1px solid #ddd; min-width:120px; margin-left:6px" />
          </label>
          <div class="small-muted">Trả lại: <strong id="change_due">0đ</strong></div>
        </div>
      </div>

      <div id="qrContainer" class="qr-box hidden" aria-hidden="true" title="Quét mã để thanh toán"></div>
      <div id="qrError" class="error hidden" role="alert"></div>

      <!-- Thêm input tên đơn hàng và nút lưu hoá đơn -->
      <div style="display:flex; gap:8px; margin-top:12px; align-items:center; flex-wrap:wrap">
        <label class="small-muted">Tên đơn:
          <input id="order_name" type="text" placeholder="Mặc định: H:i d-m-y" style="padding:6px;border-radius:6px;border:1px solid #ddd; min-width:180px; margin-left:6px" />
        </label>

        <button class="btn" id="saveInvoiceBtn" title="Lưu hoá đơn">Lưu hoá đơn</button>
        <button class="btn" id="closeModal">Đóng</button>
      </div>
    </div>
  </div>

  <!-- Import JS đúng chuẩn GitHub Pages -->
  <script type="module" src="./assets/js/app.js?v=2" defer></script>
</body>
</html>
