<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Danh sách sản phẩm</title>

  <!-- CSS -->
  <link rel="stylesheet" href="./assets/css/styles.css?v=3" />
</head>

<body class="mode-items">

  <h1>Danh sách sản phẩm</h1>

  <!-- ===== TOP CONTROLS ===== -->
  <div class="top-controls">
    <button class="btn toggle" id="showFavsBtn" aria-pressed="false">
      Yêu thích
    </button>

    <button class="btn" id="showInvoicesBtn">
      Hoá đơn
    </button>
  </div>

  <!-- ===== INVOICE LIST PANEL (ONLY IN INVOICE MODE) ===== -->
  <div id="invoiceListPanel" style="width:420px; max-width:100%;">
    <div style="
      background:#fff;
      border-radius:10px;
      padding:10px;
      border:1px solid #e6e9ef;
      box-shadow:0 8px 20px rgba(12,24,40,0.04);
    ">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
        <strong>Danh sách hoá đơn</strong>
        <button class="btn" id="refreshInvoicesBtn" style="padding:6px 10px;">
          Tải lại
        </button>
      </div>

      <div id="invoiceList" style="max-height:360px; overflow:auto;">
        <!-- renderInvoiceList() -->
      </div>

      <div id="invoiceListEmpty" class="muted hidden" style="padding-top:8px;">
        Chưa có hoá đơn nào.
      </div>
    </div>
  </div>

  <!-- ===== PRODUCT LIST ===== -->
  <div class="list" id="product-list" aria-live="polite">
    <!-- render products -->
  </div>

  <!-- ===== BOTTOM CONTROLS ===== -->
  <div class="bottom-controls">
    <div class="control">
      <label class="muted">
        Phí ship
        <input id="ship_fee" type="text" value="0" data-raw="0" inputmode="numeric" />
      </label>
    </div>

    <div class="control">
      <label class="muted">
        Giảm giá
        <input id="discount" type="text" value="0" data-raw="0" inputmode="numeric" />
      </label>
    </div>

    <div class="actions" style="margin-left:auto;">
      <button class="btn" id="resetBtn">Reset</button>
      <button class="btn" id="collapseBtn">Hoá đơn</button>
    </div>
  </div>

  <!-- ===== SUMMARY ===== -->
  <div class="summary">
    <div class="muted">
      Món đã chọn: <span id="selectedCount">0</span>
      · Yêu thích: <span id="favCount">0</span>
    </div>
    <div class="total">
      Tổng: <span id="grandTotal">0</span> ₫
    </div>
  </div>

  <!-- ===== MODAL INVOICE ===== -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal" role="document">

      <h2>Hoá đơn</h2>

      <div id="compactList" class="compact"></div>

      <div class="footer">
        <div class="meta-lines">
          <div>Phí ship: <span id="modal_ship">0đ</span></div>
          <div>Giảm giá: <span id="modal_discount">0đ</span></div>
        </div>
        <div class="total-line">
          Tổng: <span id="modal_total">0đ</span>
        </div>
      </div>

      <!-- PAYMENT -->
      <div class="payment-row">
        <div class="small-muted">
          <label>
            <input type="radio" name="payment_method" value="cash" checked />
            Tiền mặt
          </label>
          <label style="margin-left:10px;">
            <input type="radio" name="payment_method" value="qr" />
            QR
          </label>
        </div>

        <div class="cash-box" id="cashContainer">
          <label class="small-muted">
            Tiền khách đưa:
            <input id="cash_given" type="text" value="0" data-raw="0" inputmode="numeric"
                   style="padding:6px; border-radius:6px; border:1px solid #ddd; min-width:120px;" />
          </label>
          <div class="small-muted">
            Trả lại: <strong id="change_due">0đ</strong>
          </div>
        </div>
      </div>

      <!-- QR -->
      <div id="qrContainer" class="qr-box hidden"></div>
      <div id="qrError" class="error hidden"></div>

      <!-- ACTIONS -->
      <div style="display:flex; gap:8px; margin-top:12px; flex-wrap:wrap;">
        <label class="small-muted">
          Tên đơn:
          <input id="order_name" type="text" placeholder="Mặc định: H:i d-m-y"
                 style="padding:6px; border-radius:6px; border:1px solid #ddd; min-width:180px;" />
        </label>

        <button class="btn" id="saveInvoiceBtn">Lưu hoá đơn</button>
        <button class="btn" id="closeModal">Đóng</button>
      </div>

    </div>
  </div>

  <!-- ===== JS ===== -->
  <script type="module" src="./assets/js/app.js?v=4"></script>

</body>
</html>
