<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Danh sách sản phẩm</title>

  <!-- CSS -->
  <link rel="stylesheet" href="./assets/css/styles.css?v=3" />
</head>

<body class="mode-items">

  <h1>Danh sách sản phẩm</h1>

  <!-- ===== TOP CONTROLS ===== -->
  <div class="top-controls">
    <button class="btn toggle" id="showFavsBtn" aria-pressed="false">
      Yêu thích
    </button>

    <button class="btn" id="showInvoicesBtn">
      Hoá đơn
    </button>

    <button class="btn" id="showStatisticalBtn">
      Thống kê
    </button>
  </div>

  <!-- ===== INVOICE LIST PANEL (ONLY IN INVOICE MODE) ===== -->
  <div class="invoice-list-wrapper">
    <div id="invoiceListPanel" style="max-width:100%;">
      <div style="
        background:#fff;
        border-radius:10px;
        padding:10px;
        border:1px solid #e6e9ef;
        box-shadow:0 8px 20px rgba(12,24,40,0.04);
      ">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
          <strong>Danh sách hoá đơn</strong>
          <div class="invoice-filters">
            <input type="date" id="filterDate" />

            <select id="filterStatus">
              <option value="all">Tất cả</option>
              <option value="1">Đơn mới</option>
              <option value="2">Đã thanh toán</option>
              <option value="3">Đã huỷ</option>
            </select>

            <select id="filterLimit">
              <option value="10" selected>10</option>
              <option value="20">20</option>
              <option value="25">25</option>
              <option value="30">30</option>
            </select>
          </div>

          <div class="invoice-pagination">
            <button class="btn" id="prevPageBtn">← Trước</button>
            <span id="pageInfo" class="muted">Trang 1</span>
            <button class="btn" id="nextPageBtn">Sau →</button>
          </div>

          <button class="btn" id="refreshInvoicesBtn" style="padding:6px 10px;">
            Tải lại
          </button>
        </div>

        <div id="invoiceList" style="overflow:auto;">
          <!-- renderInvoiceList() -->
        </div>

        <div id="invoiceListEmpty" class="muted hidden" style="padding-top:8px;">
          Chưa có hoá đơn nào.
        </div>
      </div>
    </div>
  </div>

  <!-- ===== PRODUCT LIST ===== -->
  <div class="list" id="product-list" aria-live="polite">
    <!-- render products -->
  </div>

  <!-- ===== BOTTOM CONTROLS ===== -->
  <div class="bottom-controls">
    <div class="control">
      <label class="muted">
        Phí ship
        <input id="ship_fee" type="text" value="0" data-raw="0" inputmode="numeric" />
      </label>
    </div>

    <div class="control">
      <label class="muted">
        Giảm giá
        <input id="discount" type="text" value="0" data-raw="0" inputmode="numeric" />
      </label>
    </div>

    <div class="actions" style="margin-left:auto;">
      <button class="btn" id="resetBtn">Reset</button>
      <button class="btn" id="collapseBtn">Hoá đơn</button>
    </div>
  </div>

  <!-- ===== SUMMARY ===== -->
  <div class="summary">
    <div class="muted">
      Món đã chọn: <span id="selectedCount">0</span>
      · Yêu thích: <span id="favCount">0</span>
    </div>
    <div class="total">
      Tổng: <span id="grandTotal">0</span> ₫
    </div>
  </div>

  <!-- ===== MODAL INVOICE ===== -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal" role="document">

      <h2>Hoá đơn</h2>

      <div id="compactList" class="compact"></div>

      <div class="footer">
        <div class="meta-lines">
          <div>Phí ship: <span id="modal_ship">0đ</span></div>
          <div>Giảm giá: <span id="modal_discount">0đ</span></div>
        </div>
        <div class="total-line">
          Tổng: <span id="modal_total">0đ</span>
        </div>
      </div>

      <!-- PAYMENT -->
      <div class="payment-row">
        <div class="small-muted">
          <label>
            <input type="radio" name="payment_method" value="cash" checked />
            Tiền mặt
          </label>
          <label style="margin-left:10px;">
            <input type="radio" name="payment_method" value="qr" />
            QR
          </label>
        </div>

        <div class="cash-box" id="cashContainer">
          <label class="small-muted">
            Tiền khách đưa:
            <input id="cash_given" type="text" value="0" data-raw="0" inputmode="numeric"
                   style="padding:6px; border-radius:6px; border:1px solid #ddd; min-width:120px;" />
          </label>
          <div class="small-muted">
            Trả lại: <strong id="change_due">0đ</strong>
          </div>
        </div>
      </div>

      <!-- QR -->
      <div id="qrContainer" class="qr-box hidden"></div>
      <div id="qrError" class="error hidden"></div>

      <!-- ACTIONS -->
      <div style="display:flex; gap:8px; margin-top:12px; flex-wrap:wrap;">
        <label class="small-muted">
          Tên đơn:
          <input id="order_name" type="text" placeholder="Mặc định: H:i d-m-y"
                 style="padding:6px; border-radius:6px; border:1px solid #ddd; min-width:180px;" />
        </label>

        <div class="note-block">
          <label class="muted">Ghi chú hoá đơn</label>
          <textarea
            id="invoice_note"
            rows="3"
            placeholder="Ví dụ: khách quen, ship sau 30p..."
          ></textarea>
        </div>

        <button class="btn" id="saveInvoiceBtn">Lưu hoá đơn</button>
        <button class="btn" id="closeModal">Đóng</button>
      </div>

    </div>
  </div>

  <!-- ===== MODAL STATS ===== -->
  <div class="modal-backdrop hidden" id="statsBackdrop">
    <div class="modal" role="document" style="max-width: 980px; width: calc(100% - 24px);">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
        <h2 style="margin:0;">Thống kê doanh thu & lãi</h2>
        <button class="btn" id="closeStatsBtn">Đóng</button>
      </div>

      <!-- Filters -->
      <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; align-items:end;">
        <label class="small-muted">
          Từ ngày
          <input type="date" id="statsFromDate" />
        </label>

        <label class="small-muted">
          Đến ngày
          <input type="date" id="statsToDate" />
        </label>

        <label class="small-muted">
          Base cost / đơn
          <input type="text" id="statsBaseCost" value="2000" data-raw="2000" inputmode="numeric"
                 style="padding:6px; border-radius:6px; border:1px solid #ddd; min-width:120px;" />
        </label>

        <label class="small-muted">
          Phát sinh: 1 lần / N đơn
          <input type="number" id="statsExtraEveryN" value="7" min="1"
                 style="padding:6px; border-radius:6px; border:1px solid #ddd; width:90px;" />
        </label>

        <label class="small-muted">
          Chi phí phát sinh (mỗi lần)
          <input type="text" id="statsExtraAvgCost" value="500" data-raw="500" inputmode="numeric"
                 style="padding:6px; border-radius:6px; border:1px solid #ddd; min-width:120px;" />
        </label>

        <button class="btn" id="runStatsBtn">Chạy thống kê</button>
      </div>

      <!-- Summary -->
      <div style="margin-top:12px; background:#fff; border:1px solid #e6e9ef; border-radius:10px; padding:10px;">
        <div id="statsSummary" class="muted">Chưa chạy thống kê.</div>
        <div id="statsWarnings" class="error hidden" style="margin-top:6px;"></div>
      </div>

      <!-- Table -->
      <div style="margin-top:12px; overflow:auto; border:1px solid #e6e9ef; border-radius:10px;">
        <table style="width:100%; border-collapse:collapse; min-width:860px;">
          <thead>
            <tr style="background:#f7f8fb;">
              <th style="text-align:left; padding:10px; border-bottom:1px solid #e6e9ef;">Món</th>
              <th style="text-align:right; padding:10px; border-bottom:1px solid #e6e9ef;">SL</th>
              <th style="text-align:right; padding:10px; border-bottom:1px solid #e6e9ef;">Doanh thu</th>
              <th style="text-align:right; padding:10px; border-bottom:1px solid #e6e9ef;">Cost món</th>
              <th style="text-align:right; padding:10px; border-bottom:1px solid #e6e9ef;">Overhead phân bổ</th>
              <th style="text-align:right; padding:10px; border-bottom:1px solid #e6e9ef;">Lãi</th>
              <th style="text-align:right; padding:10px; border-bottom:1px solid #e6e9ef;">Biên lãi</th>
            </tr>
          </thead>
          <tbody id="statsTableBody">
            <tr><td colspan="7" class="muted" style="padding:10px;">Chưa có dữ liệu.</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ===== JS ===== -->
  <script type="module" src="./assets/js/app.js?v=62"></script>

</body>
</html>
