<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Danh sách sản phẩm</title>
  <style>
    :root{--gap:12px;--pad:14px;--muted:#666}
    body { font-family: Arial, sans-serif; padding: 18px; margin:0; background:#fafafa }
    h1{margin:0 0 12px}

    .list { display:flex; flex-direction:column; gap:12px }
    .item { background:#fff; border-radius:8px; padding:12px; box-shadow:0 0 0 1px #eee }
    .item .name { font-weight:700; margin-bottom:8px }

    .price-line{display:flex; gap:12px; align-items:center}
    .price-block{flex:1; display:flex; flex-direction:column}
    .label-inline{font-size:12px; color:var(--muted)}
    .value{font-weight:700}

    .qty-row{display:flex; gap:12px; align-items:center; margin-top:10px}
    .qty-row label{display:flex; gap:8px; align-items:center}
    .qty{width:64px; padding:6px}

    .controls{display:flex; gap:12px; align-items:center; margin-top:14px}
    .control { display:flex; flex-direction:column; gap:6px }
    .small { font-size: 13px; color: var(--muted); }

    .actions{display:flex; gap:8px; margin-top:12px}
    .btn{padding:8px 12px; border-radius:6px; border:1px solid #ddd; background:#fff}
    .btn.primary{background:#007bff;color:#fff;border-color:#007bff}

    .total { font-weight: bold; margin-top: 18px; font-size: 18px }

    /* Modal for compact summary */
    .modal-backdrop{position:fixed; inset:0; background:rgba(0,0,0,0.5); display:none; align-items:center; justify-content:center; z-index:9999}
    .modal{width:92%; max-width:420px; background:#fff; border-radius:10px; padding:12px; box-shadow:0 8px 30px rgba(0,0,0,0.15)}
    .modal h2{margin:0 0 8px}
    .modal .row{display:flex; justify-content:space-between; padding:6px 0; border-bottom:1px dashed #eee}
    .modal .footer{display:flex; justify-content:space-between; gap:8px; margin-top:10px}

    /* Compact print-friendly view inside modal */
    .compact { font-size:15px }
    .compact .line{display:flex; justify-content:space-between; padding:6px 0}
    .compact .meta{color:var(--muted); font-size:13px}

    /* Mobile tweaks */
    @media (max-width:720px){
      .price-line{gap:8px}
      .price-block{flex-basis:0}
      .qty{width:56px}
      .controls{flex-direction:row}
      .control{flex:1}
      .page-bottom-padding{height:64px}
      .btn{flex:1}
    }
  </style>
</head>
<body>
  <h1>Danh sách sản phẩm</h1>

  <div class="list" id="product-list">
    <!-- base items -->
    <div class="item"><div class="name">Nem tcc (sống)</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="3800">3.8k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Nem tcc xù (sống)</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="4000">4k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Nem tcc giỏ giòn (sống)</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="5000">5k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Nem tcc phomai (sống)</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="11000">11k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Nem tcc xù</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="6500">6.5k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Nem tcc giỏ giòn</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="7000">7k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Nem tcc phomai</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="13000">13k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Bánh rán mặn</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="8000">8k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Bánh rán phomai</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="8000">8k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Nem chua thường</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="7000">7k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Nem chua phomai</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="9000">9k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Nem chua vỏ giòn</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="5000">5k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Bánh xèo nhật</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="60000">60k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Gà chiên mắm</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="35000">35k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Chân gà rút xương</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="7000">7k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Thịt chưng mắm tép</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="35000">35k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Salad</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="40000">40k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Bún thang chay</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="45000">45k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Xôi nấm</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="45000">45k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Cốt chay</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="35000">35k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Mọc chay</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="11000">11k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Giò nấm chay</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="11000">11k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Chả cốm chay</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="12000">12k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Ruốc nấm</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="35000">35k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Xôi cốm</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="18000">18k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Chạo chay</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="40000">40k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Cốm xào</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="18000">18k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

    <div class="item"><div class="name">Canh mọc chay</div><div class="price-line"><div class="price-block"><div class="label-inline">Giá bán</div><div class="value price" data-raw="60000">60k</div></div><div class="price-block"><div class="label-inline">Thành tiền</div><div class="value subtotal">0</div></div></div><div class="qty-row"><label>Số lượng <input type="number" class="qty" /></label></div></div>

  </div>

  <div class="controls">
    <div class="control">
      <label>Phí ship
        <input type="text" id="ship_fee" data-raw="0" value="0" />
      </label>
    </div>
    <div class="control">
      <label>Chiết khấu
        <input type="text" id="discount" data-raw="0" value="0" />
      </label>
    </div>
  </div>

  <div class="actions">
    <button class="btn" id="collapseBtn">Tóm gọn đơn (Popup)</button>
  </div>

  <div class="total">Tổng tiền: <span id="total">0</span></div>

  <div class="page-bottom-padding" aria-hidden="true"></div>

  <!-- Modal -->
  <div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true">
    <div class="modal" role="document" id="modal">
      <h2>Đơn hàng (tóm gọn)</h2>
      <div id="compactList" class="compact"></div>
      <div class="footer">
        <div class="meta">Ship: <span id="modal_ship">0</span> · Discount: <span id="modal_discount">0</span></div>
        <div style="font-weight:700">Tổng: <span id="modal_total">0</span></div>
      </div>
      <div style="display:flex; gap:8px; margin-top:10px">
        <button class="btn" id="closeModal">Đóng</button>
      </div>
    </div>
  </div>

  <script>
    function formatK(num) {
      if (!isFinite(num)) return '0';
      const k = num / 1000;
      if (Number.isInteger(k)) return k + 'k';
      return (Math.round(k * 10) / 10) + 'k';
    }
    function formatVND(num) {
      if (!isFinite(num)) return '0';
      return new Intl.NumberFormat('vi-VN').format(num);
    }
    function parseRaw(val) {
      if (val == null) return 0;
      if (typeof val === 'string') {
        const cleaned = val.replace(/[^0-9\-]/g,'');
        return parseInt(cleaned) || 0;
      }
      return Number(val) || 0;
    }

    function init(){
      document.querySelectorAll('.price').forEach(el=>{ const raw=parseRaw(el.dataset.raw); el.textContent=formatK(raw)});
      ['ship_fee','discount'].forEach(id=>{ const el=document.getElementById(id); const n=parseRaw(el.value||el.dataset.raw); el.dataset.raw=n; el.value=formatVND(n)});
      document.querySelectorAll('.qty').forEach(q=>q.addEventListener('input',calculate));
      setupFormattedInput('ship_fee'); setupFormattedInput('discount');
      document.getElementById('collapseBtn').addEventListener('click',openCompactPopup);
      document.getElementById('closeModal').addEventListener('click',closeModal);
      calculate();
    }

    function calculate(){
      let total=0;
      document.querySelectorAll('.item').forEach(item=>{
        const price=parseRaw(item.querySelector('.price').dataset.raw);
        const qty=parseInt(item.querySelector('.qty').value)||0;
        const subtotal=price*qty;
        const subEl=item.querySelector('.subtotal'); if(subEl) subEl.textContent=formatK(subtotal);
        total+=subtotal;
      });
      const ship=parseRaw(document.getElementById('ship_fee').dataset.raw||document.getElementById('ship_fee').value);
      const discount=parseRaw(document.getElementById('discount').dataset.raw||document.getElementById('discount').value);
    }

    function setupFormattedInput(id){
      const el=document.getElementById(id);
      el.addEventListener('input',e=>{ const digits=(e.target.value||'').replace(/[^0-9]/g,''); const n=parseInt(digits)||0; e.target.dataset.raw=n; e.target.value=formatVND(n); calculate(); });
      el.addEventListener('focus',e=>{ e.target.value=String(e.target.dataset.raw||'0'); setTimeout(()=>{try{e.target.setSelectionRange(e.target.value.length,e.target.value.length)}catch(err){}},0) });
      el.addEventListener('blur',e=>{ const n=parseRaw(e.target.value)||parseRaw(e.target.dataset.raw); e.target.dataset.raw=n; e.target.value=formatVND(n); calculate(); });
    }

    // Build compact popup content: only items with qty>0, minimal layout for screenshot
    function openCompactPopup(){
      const listEl=document.getElementById('compactList'); listEl.innerHTML='';
      let total=0; let count=0;
      document.querySelectorAll('.item').forEach(item=>{
        const name=item.querySelector('.name').textContent.trim();
        const price=parseRaw(item.querySelector('.price').dataset.raw);
        const qty=parseInt(item.querySelector('.qty').value)||0;
        if(qty>0){
          count++;
          const subtotal=price*qty; total+=subtotal;
          const row=document.createElement('div'); row.className='line';
          row.innerHTML=`<div style="flex:1">${count}. ${escapeHtml(name)} x${qty}</div><div style="min-width:80px; text-align:right">${formatVND(subtotal)}</div>`;
          listEl.appendChild(row);
        }
      });

      // ship & discount
      const ship=parseRaw(document.getElementById('ship_fee').dataset.raw||document.getElementById('ship_fee').value);
      const discount=parseRaw(document.getElementById('discount').dataset.raw||document.getElementById('discount').value);
      document.getElementById('modal_ship').textContent = formatVND(ship);
      document.getElementById('modal_discount').textContent = formatVND(discount);
      document.getElementById('modal_total').textContent = formatVND(total + ship - discount);

      // If no items selected, show message
      if(count===0){ listEl.innerHTML='<div class="meta">Chưa có món nào được chọn.</div>'; }

      // show modal
      const backdrop=document.getElementById('modalBackdrop'); backdrop.style.display='flex';
    }

    function closeModal(){ document.getElementById('modalBackdrop').style.display='none'; }

    function escapeHtml(str){ return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    // init
    init();
  </script>
</body>
</html>

